# 🏗️ Terraform Infrastructure

This directory contains all Terraform configuration files for the EKS infrastructure.

## 📁 Directory Structure

```
terraform/
├── main.tf                    # Main infrastructure configuration
├── variables.tf               # Input variables
├── output.tf                  # Output values
├── versions.tf                # Provider version constraints
├── backend.tf                 # S3/DynamoDB backend configuration
├── data.tf                    # Data sources
├── locals.tf                  # Local values
├── jenkins-server.tf          # Jenkins server configuration (if exists)
├── terraform.tfvars           # Variable values (gitignored)
├── terraform.tfvars.example   # Example variable values
├── .terraform/                # Terraform working directory
├── .terraform.lock.hcl        # Provider version locks
├── terraform.tfstate          # Current state (if local)
└── terraform.tfstate.backup   # State backup (if local)
```

## 🚀 Usage Instructions

### **Initial Setup**
```bash
# Navigate to terraform directory
cd terraform

# Initialize Terraform
terraform init

# Review the plan
terraform plan

# Apply infrastructure
terraform apply
```

### **Daily Operations**
```bash
# Check infrastructure status
terraform show

# Update infrastructure
terraform plan
terraform apply

# Destroy infrastructure (when needed)
terraform destroy
```

### **Configuration**
1. Copy `terraform.tfvars.example` to `terraform.tfvars`
2. Update variables in `terraform.tfvars` with your values
3. Run `terraform init` to initialize
4. Run `terraform plan` to review changes
5. Run `terraform apply` to deploy

## 🔧 Backend Configuration

The infrastructure uses **S3 + DynamoDB** for remote state management:
- **S3 Bucket**: Stores Terraform state files
- **DynamoDB Table**: Provides state locking
- **Encryption**: State files are encrypted at rest

## 📊 Key Resources Created

- **EKS Cluster**: Kubernetes cluster with worker nodes
- **VPC**: Virtual Private Cloud with public/private subnets  
- **ALB**: Application Load Balancer for web traffic
- **EC2**: Web servers, app servers, Jenkins server
- **IAM**: Roles and policies for secure access
- **S3/DynamoDB**: Backend state management

## 🛡️ Security Features

- Private subnets for app servers and EKS workers
- Security groups with least privilege access
- IAM roles with minimal required permissions
- Encrypted storage and communication

## 📋 Common Commands

```bash
# Format Terraform files
terraform fmt

# Validate configuration
terraform validate

# Show current state
terraform show

# List all resources
terraform state list

# Import existing resource
terraform import [resource_type].[name] [resource_id]

# Move state resource
terraform state mv [old_name] [new_name]
```

## 🔍 Troubleshooting

**State Locked Error:**
```bash
terraform force-unlock [LOCK_ID]
```

**Provider Issues:**
```bash
terraform init -upgrade
```

**State Drift:**
```bash
terraform refresh
terraform plan
```

## 🌍 Multi-Environment Support

To manage multiple environments, use workspaces:
```bash
# Create workspace
terraform workspace new dev
terraform workspace new staging
terraform workspace new prod

# Switch workspace
terraform workspace select dev

# List workspaces
terraform workspace list
```

---

## 📞 Support

For infrastructure issues:
1. Check `terraform plan` output
2. Review AWS CloudTrail logs
3. Check EKS cluster status
4. Verify IAM permissions

**Generated by Terraform organization script**
